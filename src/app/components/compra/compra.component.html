<br>
<div class="container">
    <form [formGroup]="myForm" (ngSubmit)="validarFormulario()" novalidate>
        <div class="row">
            <div class="col-lg-12">
                <h5 style="text-align: center;">Compra</h5>
                <mat-radio-group>
                    <mat-radio-button (change)="varificarTipoCompra($event)" checked="true" value="1">Producto
                    </mat-radio-button>
                    <mat-radio-button (change)="varificarTipoCompra($event)" value="2">Kit</mat-radio-button>
                </mat-radio-group>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-lg-6">
                <div [hidden]="seccionProducto">
                    <mat-form-field [hidden]="seccionKit" class="example-full-width">
                        <mat-label>Kits</mat-label>
                        <mat-select formControlName="_kit" (selectionChange)="onChangeSelectKit($event.value)">
                            <mat-option *ngFor="let item of kits" [value]="item.IdKit">
                                {{item.Descripcion}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="row">
                        <div class="col-lg-9 col-md-10">
                            <mat-form-field class="example-full-width">
                                <input readonly matInput placeholder="Producto" formControlName="_producto">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-3 col-md-2">
                            <button class="mt-2" type="button" mat-raised-button color="warn" [disabled]="seleccionKit"
                                (click)="seleccionarProducto()">
                                <mat-icon>control_point</mat-icon>
                            </button>
                        </div>
                    </div>
                    <mat-form-field class="example-full-width">
                        <input type="text" placeholder="Lote" matInput formControlName="_lote" [matAutocomplete]="auto">
                        <mat-autocomplete #auto="matAutocomplete">
                            <mat-option (onSelectionChange)="seleccionarLoteSiExiste(option)"
                                *ngFor="let option of filteredOptions | async" [value]="option.Codigo">
                                {{option.Codigo}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" formControlName="_cantidad" placeholder="Cantidad">
                        <mat-error *ngIf="_cantidad.invalid && (_cantidad.dirty || _cantidad.touched)">
                            <mat-error *ngIf="_cantidad.errors.required">
                                Cantidad Requerida
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div class="col-lg-6">
                <mat-form-field class="example-full-width">
                    <input matInput readonly [matDatepicker]="picker" placeholder="Fecha Expiración"
                        formControlName="_fechaExpiracion">
                    <mat-datepicker-toggle matSuffix [for]="picker">
                    </mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="_fechaExpiracion.invalid && (_fechaExpiracion.dirty || _fechaExpiracion.touched)">
                        <mat-error *ngIf="_fechaExpiracion.errors.required">
                            Fecha Expiración Requerida
                        </mat-error>
                    </mat-error>
                </mat-form-field>
                <mat-form-field class="example-full-width">
                    <input matInput type="number" formControlName="_precio" placeholder="Precio">
                    <mat-error *ngIf="_precio.invalid && (_precio.dirty || _precio.touched)">
                        <mat-error *ngIf="_precio.errors.required">
                            Precio Requerido
                        </mat-error>
                    </mat-error>
                </mat-form-field>
                <button type="submit" class="mt-2 btn-block bg-success text-white" mat-raised-button
                    [disabled]="myForm.invalid" [value]="botonInsertar">
                    Agregar Detalle
                </button>
            </div>
        </div>
    </form>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body">
                <div class="tablaDetalleCompra">
                    <table mat-table [dataSource]="detalleCompra">
                        <ng-container matColumnDef="codigo">
                            <th mat-header-cell *matHeaderCellDef> Código </th>
                            <td mat-cell *matCellDef="let element"> {{element.Codigo}} </td>
                        </ng-container>
                        <ng-container matColumnDef="kit">
                            <th mat-header-cell *matHeaderCellDef> Kit </th>
                            <ng-container *matCellDef="let element">
                                <ng-container *ngIf="element.IdKit == ''">
                                    <td mat-cell> </td>
                                </ng-container>
                                <ng-container *ngIf="element.IdKit != ''">
                                    <td mat-cell> {{element.Kit}} </td>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                        <ng-container matColumnDef="descripcion">
                            <th mat-header-cell *matHeaderCellDef> Descripción </th>
                            <td mat-cell *matCellDef="let element"> {{element.Producto}} </td>
                        </ng-container>
                        <ng-container matColumnDef="presentacion">
                            <th mat-header-cell *matHeaderCellDef> Presentación </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.ContenidoNeto}} {{element.Medida}} </td>
                        </ng-container>
                        <ng-container matColumnDef="lote">
                            <th mat-header-cell *matHeaderCellDef> Lote </th>
                            <td mat-cell *matCellDef="let element"> {{element.Lote}} </td>
                        </ng-container>
                        <ng-container matColumnDef="fechaExpiracion">
                            <th mat-header-cell *matHeaderCellDef> Fecha Expiración </th>
                            <td mat-cell *matCellDef="let element"> {{element.FechaExpiracion}} </td>
                        </ng-container>
                        <ng-container matColumnDef="valorUnitario">
                            <th mat-header-cell *matHeaderCellDef> V. Unitario </th>
                            <td mat-cell *matCellDef="let element"> {{element.ValorUnitario}} </td>
                        </ng-container>
                        <ng-container matColumnDef="cantidad">
                            <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                            <td mat-cell *matCellDef="let element"> {{element.Cantidad}} </td>
                        </ng-container>
                        <ng-container matColumnDef="total">
                            <th mat-header-cell *matHeaderCellDef> Total </th>
                            <td mat-cell *matCellDef="let element"> {{element.Total}} </td>
                        </ng-container>
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef> Acciones </th>
                            <ng-container *matCellDef="let element">
                                <td mat-cell>
                                    <button tooltip="Quitar" placement="top" class="btn btn-sm btn-outline-danger"
                                        (click)="quitarDetalle(element)">
                                        <i class="fa fa-times" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="tablaDetalleCompra; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: tablaDetalleCompra;"></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <button type="button" mat-raised-button [disabled]="realizarCompraButton" (click)="realizarCompra()"
                class="mt-3 mb-3 btn-block bg-primary text-white">
                Realizar Compra
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <mat-accordion>
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Facturas Sin Finalizar
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card-body">
                        <div class="tablaFacturasNoFinalidas">
                            <table mat-table [dataSource]="facturasNoFinalizadas">
                                <ng-container matColumnDef="codigo">
                                    <th mat-header-cell *matHeaderCellDef> Código </th>
                                    <td mat-cell *matCellDef="let element"> {{element.Codigo}} </td>
                                </ng-container>
                                <ng-container matColumnDef="usuario">
                                    <th mat-header-cell *matHeaderCellDef> Usuario </th>
                                    <td mat-cell *matCellDef="let element">
                                        {{element.PersonaEntidad.PrimerNombre}}
                                        {{element.PersonaEntidad.ApellidoPaterno}}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="fecha">
                                    <th mat-header-cell *matHeaderCellDef> Fecha </th>
                                    <td mat-cell *matCellDef="let element"> {{element.FechaGeneracion}} </td>
                                </ng-container>
                                <ng-container matColumnDef="acciones">
                                    <th mat-header-cell *matHeaderCellDef> Acciones </th>
                                    <ng-container *matCellDef="let element">
                                        <td mat-cell>
                                            <button mat-button color="accent" tooltip="Modificar" placement="top"
                                                (click)="mostrarDetallesFactura(element)">
                                                <mat-icon>format_line_spacing</mat-icon>
                                            </button>
                                        </td>
                                    </ng-container>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="tablaFacturasNoFinalidas; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; columns: tablaFacturasNoFinalidas;"></tr>
                            </table>
                        </div>
                    </div>
                </mat-expansion-panel>
            </mat-accordion>
        </div>
    </div>
</div>
<br>