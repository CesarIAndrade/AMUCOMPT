<br>
<div class="container">
    <form [formGroup]="myForm" (ngSubmit)="validarFormulario()" novalidate>
        <div class="row">
            <div class="col-lg-12">
                <h5 style="text-align: center;">Compra</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-5">
                <mat-form-field class="example-full-width">
                    <input type="text" placeholder="Lote" matInput formControlName="_lote" [matAutocomplete]="auto">
                    <mat-autocomplete #auto="matAutocomplete">
                        <mat-option (onSelectionChange)="seleccionarLoteSiExiste(option)"
                            *ngFor="let option of filteredOptions | async" [value]="option.Codigo">
                            {{option.Codigo}}
                        </mat-option>
                    </mat-autocomplete>
                    <mat-error *ngIf="_lote.invalid && (_lote.dirty || _lote.touched)">
                        <mat-error *ngIf="_lote.errors.required">
                            Lote Requerido
                        </mat-error>
                    </mat-error>
                </mat-form-field>
                <mat-radio-group>
                    <mat-radio-button (change)="varificarTipoCompra($event)" checked="true" value="1">Producto
                    </mat-radio-button>
                    <mat-radio-button (change)="varificarTipoCompra($event)" value="2">Kit</mat-radio-button>
                </mat-radio-group>
                <div [hidden]="seccionProducto">
                    <mat-form-field [hidden]="seccionKit" class="example-full-width">
                        <mat-label>Kits</mat-label>
                        <mat-select formControlName="_kit" (selectionChange)="onChangeSelectKit($event.value)">
                            <mat-option *ngFor="let item of kits" [value]="item.IdKit">
                                {{item.Descripcion}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button type="button" [disabled]="seleccionKit"
                        class="mb-3 btn btn-sm btn-block btn-outline-warning" (click)="seleccionarProducto()">
                        <i class="fa fa-plus"></i>
                    </button>
                    <mat-form-field class="example-full-width">
                        <input readonly matInput placeholder="Producto" formControlName="_producto">
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" formControlName="_cantidad" placeholder="Cantidad">
                        <mat-error *ngIf="_cantidad.invalid && (_cantidad.dirty || _cantidad.touched)">
                            <mat-error *ngIf="_cantidad.errors.required">
                                Cantidad Requerida
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput readonly [matDatepicker]="picker" placeholder="Fecha Expiraci贸n"
                            formControlName="_fechaExpiracion">
                        <mat-datepicker-toggle matSuffix [for]="picker">
                        </mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                        <mat-error
                            *ngIf="_fechaExpiracion.invalid && (_fechaExpiracion.dirty || _fechaExpiracion.touched)">
                            <mat-error *ngIf="_fechaExpiracion.errors.required">
                                Fecha Expiraci贸n Requerida
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" formControlName="_precio" placeholder="Precio">
                        <mat-error *ngIf="_precio.invalid && (_precio.dirty || _precio.touched)">
                            <mat-error *ngIf="_precio.errors.required">
                                Precio Requerido
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <button type="submit" [disabled]="myForm.invalid" #testButton [value]="botonInsertar"
                        class="mt-3 mb-3 btn btn-success btn-block">Agregar
                        Detalle</button>
                </div>
            </div>
            <div class="col-lg-7">
                <div class="card-body mat-elevation-z5">
                    <div class="tablaDetalleCompra">
                        <table mat-table [dataSource]="detallesCompra">
                            <ng-container matColumnDef="kit">
                                <th mat-header-cell *matHeaderCellDef> Kit </th>
                                <ng-container *matCellDef="let element">
                                    <ng-container *ngIf="element.IdKit == ''">
                                        <td mat-cell> </td>
                                    </ng-container>
                                    <ng-container *ngIf="element.IdKit != ''">
                                        <td mat-cell> {{element.Kit}} </td>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                            <ng-container matColumnDef="descripcion">
                                <th mat-header-cell *matHeaderCellDef> Descripci贸n </th>
                                <td mat-cell *matCellDef="let element"> {{element.Producto}} {{element.Presentacion}}
                                    {{element.ContenidoNeto}} {{element.Medida}} </td>
                            </ng-container>
                            <ng-container matColumnDef="acciones">
                                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                                <ng-container *matCellDef="let element">
                                    <td mat-cell>
                                        <button tooltip="Quitar" placement="top" class="btn btn-sm btn-outline-danger"
                                            (click)="quitarDetalle(element)">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </ng-container>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="tablaDetalleCompra; sticky: true"></tr>
                            <tr mat-row *matRowDef="let row; columns: tablaDetalleCompra;"></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="row">
        <div class="col-lg-12">
            <button #realizarCompraButton type="button" disabled="true" (click)="realizarCompra()"
                class="mt-3 mb-3 btn btn-primary btn-block">
                Realizar Compra
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body mat-elevation-z5">
                <div class="tablaFacturasNoFinalidas">
                    <table mat-table [dataSource]="facturasNoFinalizadas">
                        <ng-container matColumnDef="codigo">
                            <th mat-header-cell *matHeaderCellDef> C贸digo </th>
                            <td mat-cell *matCellDef="let element"> {{element.Codigo}} </td>
                        </ng-container>
                        <ng-container matColumnDef="usuario">
                            <th mat-header-cell *matHeaderCellDef> Usuario </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.PersonaEntidad.PrimerNombre}}
                                {{element.PersonaEntidad.ApellidoPaterno}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="fecha">
                            <th mat-header-cell *matHeaderCellDef> Fecha </th>
                            <td mat-cell *matCellDef="let element"> {{element.FechaGeneracion}} </td>
                        </ng-container>
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef> Acciones </th>
                            <ng-container *matCellDef="let element">
                                <td mat-cell>
                                    <button tooltip="Modificar" placement="top" class="btn btn-sm btn-outline-info"
                                        (click)="mostrarDetallesFactura(element)">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="tablaFacturasNoFinalidas; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: tablaFacturasNoFinalidas;"></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>