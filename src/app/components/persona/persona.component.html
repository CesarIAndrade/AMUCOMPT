<div class="container">
    <form [formGroup]="myForm" (ngSubmit)="validarFormulario()" novalidate>
        <div class="row">
            <div class="col-lg-4">
                <div class="card-body">
                    <h5 style="text-align: center;">{{ nuevaPersona }}</h5>
                    <mat-form-field class="example-full-width">
                        <input matInput type="text" formControlName="_nombres" placeholder="Ingrese Nombres">
                        <mat-error *ngIf="_nombres.invalid && (_nombres.dirty || _nombres.touched)">
                            <mat-error *ngIf="_nombres.errors.required">
                                Nombres Requeridos
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput type="text" formControlName="_apellidos" placeholder="Ingrese Apellidos">
                        <mat-error *ngIf="_apellidos.invalid && (_apellidos.dirty || _apellidos.touched)">
                            <mat-error *ngIf="_apellidos.errors.required">
                                Apellidos Requeridos
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <mat-label>Seleccione Tipo Documento</mat-label>
                        <mat-select formControlName="_tipoDocumento">
                            <mat-option *ngFor="let item of tipoDocumentos" [value]="item.IdTipoDocumento">
                                {{item.Documento}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="_tipoDocumento.invalid && (_tipoDocumento.dirty || _tipoDocumento.touched)">
                            <mat-error *ngIf="_tipoDocumento.errors.required">
                                Tipo Documento Requerido
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <input matInput formControlName="_numeroDocumento" placeholder="Ingrese Número Documento">
                        <mat-error
                            *ngIf="_numeroDocumento.invalid && (_numeroDocumento.dirty || _numeroDocumento.touched)">
                            <mat-error *ngIf="_numeroDocumento.errors.required">
                                Número de Documento Requerido
                            </mat-error>
                            <mat-error *ngIf="_numeroDocumento.errors.maxlength">
                                Máximo 10 Dígitos
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card-body">
                    <h5 style="text-align: center;">{{ contacto }}</h5>
                    <div class="row">
                        <div class="col-lg-6">
                            <mat-form-field class="example-full-width">
                                <input matInput type="number" formControlName="_telefono1" placeholder="Primer Telefono"
                                    maxlength="10">
                                <mat-error *ngIf="_telefono1.invalid && (_telefono1.dirty || _telefono1.touched)">
                                    <mat-error *ngIf="_telefono1.errors.required">
                                        Primer Telefono Requerido
                                    </mat-error>
                                    <mat-error *ngIf="_telefono1.errors.maxlength">
                                        Máximo 10 Dígitos
                                    </mat-error>
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-6">
                            <mat-form-field class="example-full-width">
                                <mat-label>Tipo Telefono</mat-label>
                                <mat-select formControlName="_tipoTelefono1">
                                    <mat-option *ngFor="let item of tipoTelefonos" [value]="item.IdTipoTelefono">
                                        {{item.Descripcion}}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="_tipoTelefono1.invalid && (_tipoTelefono1.dirty || _tipoTelefono1.touched)">
                                    <mat-error *ngIf="_tipoTelefono1.errors.required">
                                        Tipo Teléfono Requerido
                                    </mat-error>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <mat-form-field class="example-full-width">
                                <input matInput type="number" formControlName="_telefono2"
                                    placeholder="Segundo Telefono">
                                <mat-error *ngIf="_telefono2.invalid && (_telefono2.dirty || _telefono2.touched)">
                                    <mat-error *ngIf="_telefono2.errors.required">
                                        Segundo Telefono Requerido
                                    </mat-error>
                                    <mat-error *ngIf="_telefono2.errors.maxlength">
                                        Máximo 10 Dígitos
                                    </mat-error>
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-6">
                            <mat-form-field class="example-full-width">
                                <mat-label>Tipo Telefono</mat-label>
                                <mat-select formControlName="_tipoTelefono2">
                                    <mat-option *ngFor="let item of tipoTelefonos" [value]="item.IdTipoTelefono">
                                        {{item.Descripcion}}
                                    </mat-option>
                                </mat-select>
                                <mat-error
                                    *ngIf="_tipoTelefono2.invalid && (_tipoTelefono2.dirty || _tipoTelefono2.touched)">
                                    <mat-error *ngIf="_tipoTelefono2.errors.required">
                                        Tipo Teléfono Requerido
                                    </mat-error>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                    <mat-form-field class="example-full-width">
                        <input matInput placeholder="Ingrese Correo" formControlName="_correo"
                            [errorStateMatcher]="matcher">
                        <mat-error *ngIf="_correo.hasError('email')">
                            Ingrese Dirección de Correo Válida
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card-body">
                    <h5 style="text-align: center;">{{ direccion }}</h5>
                    <mat-form-field class="example-full-width">
                        <mat-label>Seleccionar Provincia</mat-label>
                        <mat-select formControlName="_provincia"
                            (selectionChange)="consultarCantonesDeUnaProvincia($event.value)">
                            <mat-option *ngFor="let item of provincias" [value]="item.IdProvincia">
                                {{item.Descripcion}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="_provincia.invalid && (_provincia.dirty || _provincia.touched)">
                            <mat-error *ngIf="_provincia.errors.required">
                                Provincia Requerida
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <mat-label>Seleccionar Cantón</mat-label>
                        <mat-select formControlName="_canton" 
                            (selectionChange)="consultarParroquiasDeUnCanton($event.value)">
                            <mat-option *ngFor="let item of cantones" [value]="item.IdCanton">
                                {{item.Descripcion}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="_canton.invalid && (_canton.dirty || _canton.touched)">
                            <mat-error *ngIf="_canton.errors.required">
                                Cantón Requerido
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                        <mat-label>Seleccionar Parroquia</mat-label>
                        <mat-select formControlName="_parroquia">
                            <mat-option *ngFor="let item of parroquias" [value]="item.IdParroquia">
                                {{item.Descripcion}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="_parroquia.invalid && (_parroquia.dirty || _parroquia.touched)">
                            <mat-error *ngIf="_parroquia.errors.required">
                                Parroquia Requerida
                            </mat-error>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div>
                    <button type="submit" class="btn btn-success btn-block" [value]="botonInsertar"
                        #testButton>{{ guardar }}</button>
                </div>
            </div>
        </div>
    </form>
    <br>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body mat-elevation-z5">
                <mat-form-field class="example-full-width">
                    <input matInput [(ngModel)]="filterPersona" type="text" placeholder="Buscar Persona">
                    <button mat-button matPrefix mat-icon-button>
                        <mat-icon>search</mat-icon>
                    </button>
                </mat-form-field>
                <div class="tablaPersonas">
                    <table mat-table
                        [dataSource]="personas|filter:filterPersona:'PrimerNombre':'SegundoNombre':'ApellidoPaterno':'ApellidoMaterno':'NumeroDocumento'">
                        <ng-container matColumnDef="nombres">
                            <th mat-header-cell *matHeaderCellDef> Nombres </th>
                            <td mat-cell *matCellDef="let element"> {{ element.PrimerNombre }}
                                {{ element.SegundoNombre }}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="apellidos">
                            <th mat-header-cell *matHeaderCellDef> Apellidos </th>
                            <td mat-cell *matCellDef="let element"> {{ element.ApellidoPaterno }}
                                {{ element.ApellidoMaterno }} </td>
                        </ng-container>
                        <ng-container matColumnDef="documento">
                            <th mat-header-cell *matHeaderCellDef> Documento </th>
                            <td mat-cell *matCellDef="let element"> {{ element.TipoDocumento }} </td>
                        </ng-container>
                        <ng-container matColumnDef="numeroDocumento">
                            <th mat-header-cell *matHeaderCellDef> No. Documento </th>
                            <td mat-cell *matCellDef="let element"> {{element.NumeroDocumento}} </td>
                        </ng-container>
                        <ng-container matColumnDef="acciones">
                            <th colspan="3" mat-header-cell *matHeaderCellDef> Acciones </th>
                            <ng-container *matCellDef="let element">
                                <ng-container *ngIf="element.IdUsuario == ''">
                                    <td mat-cell>
                                        <button tooltip="Ver Información" placement="top"
                                            class="btn btn-sm btn-outline-primary" (click)="abrirModal(element)">
                                            <i class="fa fa-eye" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td mat-cell>
                                        <button tooltip="Modificar" placement="top" class="btn btn-sm btn-outline-info"
                                            (click)="mostrarPersona(element)">
                                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td mat-cell>
                                        <button tooltip="Eliminar" placement="top" class="btn btn-sm btn-outline-danger"
                                            (click)="eliminarPersona(element.IdPersona)">
                                            <i class="fa fa-trash" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </ng-container>
                                <ng-container *ngIf="element.IdUsuario != ''">
                                    <td mat-cell>
                                        <button tooltip="Ver Información" placement="top"
                                            class="btn btn-sm btn-outline-primary" (click)="abrirModal(element)">
                                            <i class="fa fa-eye" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td mat-cell>
                                        <button tooltip="Modificar" placement="top" class="btn btn-sm btn-outline-info"
                                            (click)="mostrarPersona(element)">
                                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td mat-cell>
                                    </td>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="tablaPersonas; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: tablaPersonas;"></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>